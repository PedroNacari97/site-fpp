{% extends "admin_custom/base_admin.html" %}
{% block title %}Programas de Fidelidade de {{ cliente.usuario.get_full_name|default:cliente.usuario.username }}{% endblock %}
{% block header_title %}Programas de Fidelidade de {{ cliente.usuario.get_full_name|default:cliente.usuario.username }}{% endblock %}
{% block header_subtitle %}<p class="page-subtitle">Todos os programas do cliente com saldos, valores e acesso rápido às movimentações.</p>{% endblock %}
{% block header_actions %}
<a href="{% url 'admin_contas' %}" class="btn btn--ghost">Voltar para Contas</a>
{% endblock %}

{% block content %}
<section class="surface-card">
    <div class="section-heading">
        <div>
            <p class="eyebrow">Programas</p>
            <h2 class="section-title">Programas do cliente</h2>
        </div>
    </div>
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Programa</th>
                    <th>Saldo Pontos</th>
                    <th>Valor Pago</th>
                    <th>Valor Médio / mil</th>
                    <th>Limite total de CPF</th>
                    <th>CPFs já utilizados</th>
                    <th>CPFs disponíveis</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for c in lista_contas %}
                <tr>
                    <td>{{ c.conta.programa.nome }}</td>
                    <td>{{ c.saldo_pontos }}</td>
                    <td>R$ {{ c.valor_pago|floatformat:2 }}</td>
                    <td>R$ {{ c.valor_medio_milheiro|floatformat:2 }}</td>
                    <td>{% if c.cpfs_total is None %}Ilimitado{% else %}{{ c.cpfs_total }}{% endif %}</td>
                    <td>{% if c.cpfs_usados is None %}—{% else %}{{ c.cpfs_usados }}{% endif %}</td>
                    <td>{% if c.cpfs_disponiveis is None %}Ilimitado{% else %}{{ c.cpfs_disponiveis }}{% endif %}</td>
                    <td>
                        <a href="{% url 'admin_movimentacoes' c.conta.id %}" class="btn btn--ghost">Movimentações</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center text-red-400 py-4">Nenhum programa encontrado para este cliente.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
