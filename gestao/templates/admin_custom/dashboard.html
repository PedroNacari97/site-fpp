{% extends "admin_custom/base_admin.html" %}
{% block title %}Dashboard{% endblock %}
{% block header_title %}Dashboard Administrativo{% endblock %}
{% block menu_dashboard %}bg-zinc-700 text-white{% endblock %}
{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}
{% block content %}
<div class="flex items-center justify-between mb-6">
    <select id="clienteSelect" class="bg-zinc-700 text-white px-3 py-2 rounded">
        <option value="">Selecionar Cliente</option>
        {% for c in clientes %}
            <option value="{{ c.id }}" {% if selected_cliente and c.id == selected_cliente.id %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
    </select>
    <a id="novaEmissaoBtn" href="{% url 'admin_nova_emissao' %}{% if selected_cliente %}?cliente_id={{ selected_cliente.id }}{% endif %}" class="bg-violet-700 hover:bg-violet-600 text-white px-4 py-2 rounded font-bold">+ Nova Emiss√£o</a>
</div>

<div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
    <div class="bg-zinc-900 p-4 rounded shadow">
        <div class="text-sm text-zinc-400">üë• Total de Clientes</div>
        <div class="text-2xl font-bold">{{ total_clientes }}</div>
    </div>
    <div class="bg-zinc-900 p-4 rounded shadow">
        <div class="text-sm text-zinc-400">‚úàÔ∏è Total de Emiss√µes</div>
        <div class="text-2xl font-bold">{{ total_emissoes }}</div>
    </div>
    <div class="bg-zinc-900 p-4 rounded shadow">
        <div class="text-sm text-zinc-400">üí≥ Total de Pontos</div>
        <div class="text-2xl font-bold">{{ total_pontos }}</div>
    </div>
    <div class="bg-zinc-900 p-4 rounded shadow">
        <div class="text-sm text-zinc-400">üí∞ Total Economizado</div>
        <div class="text-2xl font-bold">R$ {{ total_economizado|floatformat:2 }}</div>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 mb-6">
{% for prog in programas %}
    <div class="bg-zinc-900 p-4 rounded shadow">
        <h5 class="text-violet-300 font-bold mb-2">{{ prog.nome }}</h5>
        <p class="text-sm text-zinc-400">Pontos acumulados</p>
        <p class="font-bold">{{ prog.pontos }}</p>
        <p class="text-sm text-zinc-400 mt-2">Valor total</p>
        <p class="font-bold">R$ {{ prog.valor_total|floatformat:2 }}</p>
        <p class="text-sm text-zinc-400 mt-2">Valor m√©dio por 1.000</p>
        <p class="font-bold">R$ {{ prog.valor_medio|floatformat:2 }}</p>
        <p class="text-sm text-zinc-400 mt-2">Valor de refer√™ncia atual</p>
        <p class="font-bold">R$ {{ prog.valor_referencia|floatformat:2 }}</p>
        {% if prog.conta_id %}
        <a href="{% url 'admin_movimentacoes' prog.conta_id %}" class="mt-4 inline-block bg-violet-700 hover:bg-violet-600 text-white px-3 py-1 rounded">Ver movimenta√ß√µes</a>
        {% endif %}
    </div>
{% empty %}
    <p>Nenhum programa encontrado.</p>
{% endfor %}
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <div class="bg-zinc-900 p-4 rounded shadow">
        <h5 class="text-violet-300 font-bold mb-2">Emiss√µes</h5>
        <ul class="text-sm space-y-1">
            <li>Quantidade: <span class="font-bold">{{ emissoes.qtd }}</span></li>
            <li>Total de pontos usados: <span class="font-bold">{{ emissoes.pontos }}</span></li>
            <li>Valor total de refer√™ncia: <span class="font-bold">R$ {{ emissoes.valor_referencia|floatformat:2 }}</span></li>
            <li>Valor total pago: <span class="font-bold">R$ {{ emissoes.valor_pago|floatformat:2 }}</span></li>
            <li>Valor total economizado: <span class="font-bold">R$ {{ emissoes.valor_economizado|floatformat:2 }}</span></li>
        </ul>
        <a href="{% url 'admin_emissoes' %}" class="mt-4 inline-block bg-violet-700 hover:bg-violet-600 text-white px-3 py-1 rounded">Ver detalhes</a>
    </div>
    <div class="bg-zinc-900 p-4 rounded shadow">
        <h5 class="text-violet-300 font-bold mb-2">Hot√©is</h5>
        <ul class="text-sm space-y-1">
            <li>Quantidade de reservas: <span class="font-bold">{{ hoteis.qtd }}</span></li>
            <li>Valor de refer√™ncia acumulado: <span class="font-bold">R$ {{ hoteis.valor_referencia|floatformat:2 }}</span></li>
            <li>Valor total pago: <span class="font-bold">R$ {{ hoteis.valor_pago|floatformat:2 }}</span></li>
            <li>Valor total economizado: <span class="font-bold">R$ {{ hoteis.valor_economizado|floatformat:2 }}</span></li>
        </ul>
        <a href="{% url 'admin_hoteis' %}" class="mt-4 inline-block bg-violet-700 hover:bg-violet-600 text-white px-3 py-1 rounded">Ver detalhes</a>
    </div>
</div>

<div class="bg-zinc-900 p-4 rounded shadow">
    <h5 class="text-violet-300 font-bold mb-2">Emiss√µes por programa</h5>
    <canvas id="emissoesChart"></canvas>
</div>
{% endblock %}
{% block extra_body %}
<script>
document.getElementById('clienteSelect').addEventListener('change', function() {
    const value = this.value;
    const url = '{% url "admin_dashboard" %}';
    window.location = value ? url + '?cliente_id=' + value : url;
});
const ctx = document.getElementById('emissoesChart');
const chartData = {
    labels: [{% for item in emissoes_programa %}'{{ item.programa }}',{% endfor %}],
    datasets: [{
        label: 'Emiss√µes',
        data: [{% for item in emissoes_programa %}{{ item.quantidade }},{% endfor %}],
        backgroundColor: '#7c3aed'
    }]
};
new Chart(ctx, {type: 'bar', data: chartData, options: {scales: {y: {beginAtZero: true}}}});
</script>
{% endblock %}

