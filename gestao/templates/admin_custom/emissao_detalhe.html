{% extends "admin_custom/base_admin.html" %}

{% block title %}Detalhe da Emissão{% endblock %}
{% block header_title %}Detalhe da Emissão{% endblock %}
{% block header_actions %}
<a href="{% url 'admin_emissoes' %}" class="btn btn--ghost">Voltar para Emissões</a>
<a href="{% url 'admin_editar_emissao' emissao.id %}" class="btn btn--outline">Editar emissão</a>
{% endblock %}

{% block content %}
<div class="stacked">
  <section class="surface-card">
    <div class="section-heading">
      <div>
        <p class="eyebrow">Emissão</p>
        <h2 class="section-title">Resumo da emissão #{{ emissao.id }}</h2>
      </div>
    </div>
    <div class="form-grid form-grid--3">
      <div>
        <p class="label">Cliente</p>
        <p class="value">{{ emissao.cliente }}</p>
      </div>
      <div>
        <p class="label">Programa</p>
        <p class="value">{{ emissao.programa }}</p>
      </div>
      <div>
        <p class="label">Emissor parceiro</p>
        <p class="value">{% if emissao.emissor_parceiro %}{{ emissao.emissor_parceiro }}{% else %}—{% endif %}</p>
      </div>
      <div>
        <p class="label">Data ida</p>
        <p class="value">{{ emissao.data_ida|date:"d/m/Y H:i" }}</p>
      </div>
      <div>
        <p class="label">Data volta</p>
        <p class="value">{% if emissao.data_volta %}{{ emissao.data_volta|date:"d/m/Y H:i" }}{% else %}—{% endif %}</p>
      </div>
      <div>
        <p class="label">Quantidade de passageiros</p>
        <p class="value">{{ emissao.qtd_passageiros }}</p>
      </div>
    </div>
  </section>

  <section class="surface-card">
    <div class="section-heading">
      <div>
        <p class="eyebrow">Financeiro</p>
        <h2 class="section-title">Valores</h2>
      </div>
    </div>
    <div class="form-grid form-grid--3">
      <div>
        <p class="label">Valor referência</p>
        <p class="value">R$ {{ emissao.valor_referencia|floatformat:2 }}</p>
      </div>
      <div>
        <p class="label">Taxas*</p>
        <p class="value">R$ {{ emissao.valor_taxas|floatformat:2 }}</p>
      </div>
      <div>
        <p class="label">Custo total</p>
        <p class="value">{% if emissao.custo_total is not None %}R$ {{ emissao.custo_total|floatformat:2 }}{% else %}—{% endif %}</p>
      </div>
      <div>
        <p class="label">Economia obtida</p>
        <p class="value">{% if emissao.economia_obtida is not None %}R$ {{ emissao.economia_obtida|floatformat:2 }}{% else %}—{% endif %}</p>
      </div>
      <div>
        <p class="label">Valor do milheiro parceiro</p>
        <p class="value">{% if emissao.valor_milheiro_parceiro %}R$ {{ emissao.valor_milheiro_parceiro|floatformat:2 }}{% else %}—{% endif %}</p>
      </div>
      <div>
        <p class="label">Valor final ao cliente</p>
        <p class="value">{% if emissao.valor_venda_final %}R$ {{ emissao.valor_venda_final|floatformat:2 }}{% else %}—{% endif %}</p>
      </div>
      <div>
        <p class="label">Valor total final</p>
        <p class="value">{% if emissao.valor_total_final %}R$ {{ emissao.valor_total_final|floatformat:2 }}{% else %}—{% endif %}</p>
      </div>
      <div>
        <p class="label">Lucro</p>
        <p class="value">{% if emissao.lucro is not None %}R$ {{ emissao.lucro|floatformat:2 }}{% else %}—{% endif %}</p>
      </div>
    </div>
    <p class="helper-text mt-3">*Taxas de embarque/companhia aérea.</p>
  </section>

  <section class="surface-card">
    <div class="section-heading">
      <div>
        <p class="eyebrow">Passageiros</p>
        <h2 class="section-title">CPFs consumidos: {{ cpfs_consumidos }}</h2>
      </div>
    </div>
    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>CPF</th>
            <th>RG</th>
            <th>Passaporte</th>
            <th>Validade</th>
            <th>Data nascimento</th>
            <th>Categoria</th>
          </tr>
        </thead>
        <tbody>
          {% for passageiro in passageiros %}
          <tr>
            <td>{{ passageiro.nome }}</td>
            <td>{{ passageiro.cpf }}</td>
            <td>{{ passageiro.rg|default:"—" }}</td>
            <td>{{ passageiro.passaporte|default:"—" }}</td>
            <td>{% if passageiro.passaporte_validade %}{{ passageiro.passaporte_validade|date:"d/m/Y" }}{% else %}—{% endif %}</td>
            <td>{% if passageiro.data_nascimento %}{{ passageiro.data_nascimento|date:"d/m/Y" }}{% else %}—{% endif %}</td>
            <td>{{ passageiro.get_categoria_display }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-red-400 py-4">Nenhum passageiro registrado.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% endblock %}
